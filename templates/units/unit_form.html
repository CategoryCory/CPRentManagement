{% extends 'base.html' %}

{% block content %}
    <h2 class="mb-6 text-3xl">
        {% if unit.id %}
            Edit Unit
        {% else %}
            Add New Unit
        {% endif %}
    </h2>
    <form method="post" class="max-w-6xl space-y-6" novalidate>
        {% csrf_token %}
        {% for hidden in form.hidden_fields %}{{ hidden }}{% endfor %}
        <div class="space-y-6 lg:space-y-0 lg:grid lg:grid-cols-6 lg:gap-6">
            <div class="col-span-3 space-y-1">
                <label for="{{ form.addr_line_1.id_for_label }}">{{ form.addr_line_1.label }}</label>
                {{ form.addr_line_1 }}
                {% if form.addr_line_1.errors %}
                    {% for error in form.addr_line_1.errors %}
                        <p class="px-2 py-1 bg-red-100 text-red-600 rounded">{{ error }}</p>
                    {% endfor %}
                {% endif %}
                {% if form.addr_line_1.help_text %}
                    <p class="text-sm text-gray-500">{{ form.addr_line_1.help_text|safe }}</p>
                {% endif %}
            </div>
            <div class="col-span-3 space-y-1">
                <label for="{{ form.addr_line_2.id_for_label }}">{{ form.addr_line_2.label }}</label>
                {{ form.addr_line_2 }}
                {% if form.addr_line_2.errors %}
                    {% for error in form.addr_line_2.errors %}
                        <p class="px-2 py-1 bg-red-100 text-red-600 rounded">{{ error }}</p>
                    {% endfor %}
                {% endif %}
                {% if form.addr_line_2.help_text %}
                    <p class="text-sm text-gray-500">{{ form.addr_line_2.help_text|safe }}</p>
                {% endif %}
            </div>
        </div>
        <div class="space-y-6 lg:space-y-0 lg:grid lg:grid-cols-6 lg:gap-6">
            <div class="col-span-2 space-y-1">
                <label for="{{ form.parent_property.id_for_label }}">{{ form.parent_property.label }}</label>
                {{ form.parent_property }}
                {% if form.parent_property.errors %}
                    {% for error in form.parent_property.errors %}
                        <p class="px-2 py-1 bg-red-100 text-red-600 rounded">{{ error }}</p>
                    {% endfor %}
                {% endif %}
                {% if form.parent_property.help_text %}
                    <p class="text-sm text-gray-500">{{ form.parent_property.help_text|safe }}</p>
                {% endif %}
            </div>
            <div class="col-span-2 space-y-1">
                <label for="{{ form.unit_status.id_for_label }}">{{ form.unit_status.label }}</label>
                {{ form.unit_status }}
                {% if form.unit_status.errors %}
                    {% for error in form.unit_status.errors %}
                        <p class="px-2 py-1 bg-red-100 text-red-600 rounded">{{ error }}</p>
                    {% endfor %}
                {% endif %}
                {% if form.unit_status.help_text %}
                    <p class="text-sm text-gray-500">{{ form.unit_status.help_text|safe }}</p>
                {% endif %}
            </div>
        </div>
        <div class="space-y-6 lg:space-y-0 lg:grid lg:grid-cols-6 lg:gap-6">
            <div class="col-span-2 space-y-1">
                <label for="{{ form.rent.id_for_label }}">{{ form.rent.label }}</label>
                {{ form.rent }}
                {% if form.rent.errors %}
                    {% for error in form.rent.errors %}
                        <p class="px-2 py-1 bg-red-100 text-red-600 rounded">{{ error }}</p>
                    {% endfor %}
                {% endif %}
                {% if form.rent.help_text %}
                    <p class="text-sm text-gray-500">{{ form.rent.help_text|safe }}</p>
                {% endif %}
            </div>
            <div class="col-span-2 space-y-1">
                <label for="{{ form.square_feet.id_for_label }}">{{ form.square_feet.label }}</label>
                {{ form.square_feet }}
                {% if form.square_feet.errors %}
                    {% for error in form.square_feet.errors %}
                        <p class="px-2 py-1 bg-red-100 text-red-600 rounded">{{ error }}</p>
                    {% endfor %}
                {% endif %}
                {% if form.square_feet.help_text %}
                    <p class="text-sm text-gray-500">{{ form.square_feet.help_text|safe }}</p>
                {% endif %}
            </div>
        </div>
        <div class="space-y-6 lg:space-y-0 lg:grid lg:grid-cols-6 lg:gap-6">
            <div class="col-span-2 space-y-1">
                <label for="{{ form.unit_taxes.id_for_label }}">{{ form.unit_taxes.label }}</label>
                {{ form.unit_taxes }}
                {% if form.unit_taxes.errors %}
                    {% for error in form.unit_taxes.errors %}
                        <p class="px-2 py-1 bg-red-100 text-red-600 rounded">{{ error }}</p>
                    {% endfor %}
                {% endif %}
                {% if form.unit_taxes.help_text %}
                    <p class="text-sm text-gray-500">{{ form.unit_taxes.help_text|safe }}</p>
                {% endif %}
            </div>
            <div class="col-span-2 space-y-1">
                <label for="{{ form.unit_insurance.id_for_label }}">{{ form.unit_insurance.label }}</label>
                {{ form.unit_insurance }}
                {% if form.unit_insurance.errors %}
                    {% for error in form.unit_insurance.errors %}
                        <p class="px-2 py-1 bg-red-100 text-red-600 rounded">{{ error }}</p>
                    {% endfor %}
                {% endif %}
                {% if form.unit_insurance.help_text %}
                    <p class="text-sm text-gray-500">{{ form.unit_insurance.help_text|safe }}</p>
                {% endif %}
            </div>
        </div>
        <div class="">
            <div class="mb-2 flex items-center">
                {{ form.calculate_tax_and_ins }}
                <label
                    for="{{ form.calculate_tax_and_ins.id_for_label }}"
                    class="pl-2"
                >
                    {{ form.calculate_tax_and_ins.label }}
                </label>
                {% if form.calculate_tax_and_ins.help_text %}
                    <p class="pl-5 pb-[1px] text-sm text-gray-500 self-end">{{ form.calculate_tax_and_ins.help_text|safe }}</p>
                {% endif %}
            </div>
            {% if form.calculate_tax_and_ins.errors %}
                {% for error in form.calculate_tax_and_ins.errors %}
                    <p class="my-1 px-2 py-1 bg-red-100 text-red-600 rounded">{{ error }}</p>
                {% endfor %}
            {% endif %}
        </div>
        <div class="pt-6 flex items-center gap-4">
            <a
                href="{% url 'units:unit-list' %}"
                class="btn btn-cancel"
            >
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M11 17l-5-5m0 0l5-5m-5 5h12" />
                </svg>
                Cancel
            </a>
            <button
                type="submit"
                class="btn btn-primary"
            >
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" />
                </svg>
                Save
            </button>
        </div>
    </form>

    <script>
        const calculateTaxesCheckbox = document.getElementById("{{ form.calculate_tax_and_ins.id_for_label }}");
        const taxesInput = document.getElementById("{{ form.unit_taxes.id_for_label }}");
        const insuranceInput = document.getElementById("{{ form.unit_insurance.id_for_label }}");

        const setInputState = () => {
            if (calculateTaxesCheckbox.checked) {
                taxesInput.readOnly = true;
                taxesInput.classList.add("bg-gray-200");
                insuranceInput.classList.add("bg-gray-200");
            } else {
                taxesInput.readOnly = false;
                taxesInput.classList.remove("bg-gray-200");
                insuranceInput.classList.remove("bg-gray-200");
            }
        };

        calculateTaxesCheckbox.addEventListener("change", () => {
            setInputState();
        });

        setInputState();
    </script>
{% endblock content %}